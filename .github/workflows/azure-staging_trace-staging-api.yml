name: CI
on: push

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: fjogeleit/http-request-action@v1
        id: revieweeRequest
        with:
          url: "https://api.reviewee.it/repository/Islaevent-API/haveRejectedCommits"
          method: "GET"
      - run: "echo latest release: ${{steps.revieweeRequest.outputs.response }}"

      - uses: custom-action/action1@v1
        id: action1
        with:
          input: ${{ parseJSON(steps.revieweeRequest.outputs.response).*.success }}
      - run: "echo : ${{steps.action1.outputs }}"

      - name: Reject build if rejected commits
        if: ${{ steps.revieweeRequest.outputs.response.success == 'true' }}
        uses: actions/github-script@v3
        with:
          script: |
            core.setFailed('Please fix rejected commits')
